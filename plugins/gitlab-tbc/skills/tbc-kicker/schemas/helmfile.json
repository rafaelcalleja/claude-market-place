{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Helmfile Template",
  "description": "to-be-continuous/helmfile",
  "type": "object",
  "properties": {
    "inputs": {
      "type": "object",
      "description": "Valid inputs for Helmfile template",
      "properties": {
        "cli-image": {
          "type": "string",
          "description": "The Docker image used to run helmfile - set the version required by your Kubernetes server",
          "default": "ghcr.io/helmfile/helmfile:latest"
        },
        "scripts-dir": {
          "type": "string",
          "description": "The folder where hook scripts are located",
          "default": "."
        },
        "path": {
          "type": "string",
          "description": "Path to the helmfile.yaml to deploy",
          "default": "./helmfile.yaml"
        },
        "kube-namespace": {
          "type": "string",
          "description": "The default Kubernetes namespace to use. Leave default if GitLab Kubernetes integration is enabled."
        },
        "default-kube-config": {
          "type": "string",
          "description": "The default kubeconfig content to use. Automatically set if GitLab Kubernetes integration is enabled.",
          "default": "$KUBECONFIG"
        },
        "base-app-name": {
          "type": "string",
          "description": "Base application name",
          "default": "$CI_PROJECT_NAME",
          "x-advanced": true
        },
        "environment-url": {
          "type": "string",
          "description": "The default environments url (only define for static environment URLs declaration) supports late variable expansion (ex: https://%{environmentname}.helm.acme.com)"
        },
        "deploy-args": {
          "type": "string",
          "description": "The helmfile command with options to deploy the application (without dynamic global parameters such as helmfile path, namespace and environment name)",
          "default": "apply --suppress-secrets --wait",
          "x-advanced": true
        },
        "delete-args": {
          "type": "string",
          "description": "The helmfile command with options to cleanup the application (without dynamic global parameters such as helmfile path, namespace and environment name)",
          "default": "destroy",
          "x-advanced": true
        },
        "pgp-private-key-file": {
          "type": "string",
          "description": "PGP Private key for decrypting helmfile secrets with SOPS (optional). Should be set as a File type variable."
        },
        "pgp-passphrase": {
          "type": "string",
          "description": "Passphrase for PGP private key (optional)"
        },
        "image-pull-secret-name": {
          "type": "string",
          "description": "Name of the docker-registry k8s secret that will be created if the special GitLab deploy token is available.",
          "default": "gitlab-registry",
          "x-advanced": true
        },
        "lint-args": {
          "type": "string",
          "description": "The helmfile command with options to trigger the analysis (without dynamic arguments such as the helmfile path)",
          "default": "lint",
          "x-feature": "Helmfile Lint"
        },
        "test-args": {
          "type": "string",
          "description": "The helmfile command with options to perform acceptance test (without dynamic global arguments such as the helmfile.yaml path, namespace and environment name)",
          "default": "test --logs --cleanup",
          "x-feature": "Helmfile Test"
        },
        "review-app-name": {
          "type": "string",
          "description": "The application name for review env (only define to override default)",
          "x-feature": "Review"
        },
        "review-autostop-duration": {
          "type": "string",
          "description": "The amount of time before GitLab will automatically stop review environments",
          "default": "4 hours",
          "x-feature": "Review"
        },
        "review-environment-url": {
          "type": "string",
          "description": "The review environments url (only define for static environment URLs declaration and if different from default)",
          "x-feature": "Review"
        },
        "review-namespace": {
          "type": "string",
          "description": "The Kubernetes namespace to use for review env (only define to override default)",
          "x-feature": "Review"
        },
        "review-kube-config": {
          "type": "string",
          "description": "Specific kubeconfig for review env (only define to override default)",
          "x-feature": "Review"
        },
        "integ-app-name": {
          "type": "string",
          "description": "The application name for integration env (only define to override default)",
          "x-feature": "Integration"
        },
        "integ-autostop-duration": {
          "type": "string",
          "description": "The amount of time before GitLab will automatically stop the integration env",
          "default": "never",
          "x-feature": "Integration"
        },
        "integ-environment-url": {
          "type": "string",
          "description": "The integration environment url (only define for static environment URLs declaration and if different from default)",
          "x-feature": "Integration"
        },
        "integ-namespace": {
          "type": "string",
          "description": "The Kubernetes namespace to use for integration env (only define to override default)",
          "x-feature": "Integration"
        },
        "integ-kube-config": {
          "type": "string",
          "description": "Specific kubeconfig for integration env (only define to override default)",
          "x-feature": "Integration"
        },
        "staging-app-name": {
          "type": "string",
          "description": "The application name for staging env (only define to override default)",
          "x-feature": "Staging"
        },
        "staging-autostop-duration": {
          "type": "string",
          "description": "The amount of time before GitLab will automatically stop the staging env",
          "default": "never",
          "x-feature": "Staging"
        },
        "staging-environment-url": {
          "type": "string",
          "description": "The staging environment url (only define for static environment URLs declaration and if different from default)",
          "x-feature": "Staging"
        },
        "staging-namespace": {
          "type": "string",
          "description": "The Kubernetes namespace to use for staging env (only define to override default)",
          "x-feature": "Staging"
        },
        "staging-kube-config": {
          "type": "string",
          "description": "Specific kubeconfig for staging env (only define to override default)",
          "x-feature": "Staging"
        },
        "prod-deploy-strategy": {
          "type": "string",
          "enum": [
            "manual",
            "auto"
          ],
          "description": "Defines the deployment to production strategy.",
          "default": "manual",
          "x-feature": "Production"
        },
        "prod-app-name": {
          "type": "string",
          "description": "The application name for production env (only define to override default)",
          "x-feature": "Production"
        },
        "prod-environment-url": {
          "type": "string",
          "description": "The production environment url (only define for static environment URLs declaration and if different from default)",
          "x-feature": "Production"
        },
        "prod-namespace": {
          "type": "string",
          "description": "The Kubernetes namespace to use for production env (only define to override default)",
          "x-feature": "Production"
        },
        "prod-kube-config": {
          "type": "string",
          "description": "Specific kubeconfig for production env (only define to override default)",
          "x-feature": "Production"
        },
        "tbc-vault-image": {
          "type": "string",
          "description": "The Vault Secrets Provider image to use",
          "default": "registry.gitlab.com/to-be-continuous/tools/vault-secrets-provider:latest",
          "x-variant": "Vault"
        },
        "vault-base-url": {
          "type": "string",
          "description": "The Vault server base API url",
          "x-variant": "Vault"
        },
        "vault-oidc-aud": {
          "type": "string",
          "description": "The aud claim for the JWT",
          "default": "$CI_SERVER_URL",
          "x-variant": "Vault"
        },
        "vault-role-id": {
          "type": "string",
          "description": "The AppRole RoleID",
          "x-variant": "Vault"
        },
        "vault-secret-id": {
          "type": "string",
          "description": "The AppRole SecretID",
          "x-variant": "Vault"
        }
      },
      "additionalProperties": false
    }
  },
  "_meta": {
    "prefix": "HELMFILE_",
    "kind": "hosting",
    "is_component": true,
    "features": [
      "Helmfile Lint",
      "Helmfile Test",
      "Review",
      "Integration",
      "Staging",
      "Production"
    ],
    "variants": [
      "Vault"
    ],
    "variable_count": 39
  }
}