# Session Log Analysis Guide

This guide explains how to analyze session logs generated by the session-recorder plugin.

## Log Location

Session logs are stored in:
```
$PROJECT_DIR/.claude/session_logs/session_YYYY-MM-DD.json
```

## Basic Queries with jq

### View Session Summary

```bash
jq '{
  session_id,
  start: .start_timestamp,
  end: .end_timestamp,
  total_interactions: (.interactions | length)
}' .claude/session_logs/session_*.json
```

### Count Interactions by Type

```bash
jq '.interactions | group_by(.type) | map({type: .[0].type, count: length})' \
  .claude/session_logs/session_*.json
```

### List All User Messages

```bash
jq '.interactions[] | select(.type == "user_message") | {time: .timestamp, content}' \
  .claude/session_logs/session_*.json
```

### List All Tool Calls

```bash
jq '.interactions[] | select(.type == "tool_call") | {time: .timestamp, tool: .content.tool}' \
  .claude/session_logs/session_*.json
```

### View Assistant Summaries

```bash
jq '.interactions[] | select(.type == "assistant_summary") | .content' \
  .claude/session_logs/session_*.json
```

### Find Tools Used

```bash
jq '[.interactions[] | select(.type == "tool_call") | .content.tool] | unique' \
  .claude/session_logs/session_*.json
```

## Advanced Analysis

### Timeline of Events

```bash
jq '.interactions[] | "\(.timestamp) [\(.type)] \(.content | tostring | .[0:80])"' -r \
  .claude/session_logs/session_*.json
```

### Session Duration

```bash
jq '
  if .end_timestamp then
    "Duration: " + (
      ((.end_timestamp | fromdateiso8601) - (.start_timestamp | fromdateiso8601)) / 60 |
      floor | tostring
    ) + " minutes"
  else
    "Session not finalized"
  end
' .claude/session_logs/session_*.json
```

### Most Used Tools

```bash
jq '[.interactions[] | select(.type == "tool_call") | .content.tool] |
  group_by(.) |
  map({tool: .[0], count: length}) |
  sort_by(-.count)' \
  .claude/session_logs/session_*.json
```

### Filter by Time Range

```bash
# Last hour
jq --arg start "$(date -u -d '1 hour ago' +%Y-%m-%dT%H:%M:%SZ)" \
  '.interactions[] | select(.timestamp > $start)' \
  .claude/session_logs/session_*.json
```

## Combining Multiple Sessions

### Merge All Sessions

```bash
jq -s 'map(.interactions) | add' .claude/session_logs/session_*.json
```

### Total Statistics Across Sessions

```bash
jq -s '{
  total_sessions: length,
  total_interactions: [.[].interactions | length] | add,
  total_user_messages: [[.[].interactions[] | select(.type == "user_message")] | length] | add,
  total_tool_calls: [[.[].interactions[] | select(.type == "tool_call")] | length] | add
}' .claude/session_logs/session_*.json
```

## Exporting Data

### Export to CSV

```bash
jq -r '.interactions[] | [.timestamp, .type, (.content | tostring)] | @csv' \
  .claude/session_logs/session_*.json > session_export.csv
```

### Export Tool Usage Summary

```bash
jq -r '[.interactions[] | select(.type == "tool_call")] |
  group_by(.content.tool) |
  map([.[0].content.tool, length]) |
  .[] | @csv' \
  .claude/session_logs/session_*.json > tool_usage.csv
```

## Cleanup

### Remove Old Logs

```bash
# Remove logs older than 30 days
find .claude/session_logs -name "session_*.json" -mtime +30 -delete
```

### Archive Completed Sessions

```bash
# Create archive of finalized sessions
jq -s '[.[] | select(.end_timestamp != null)]' .claude/session_logs/session_*.json \
  > .claude/session_logs/archive_$(date +%Y%m).json
```

## Integration Examples

### Slack Notification

```bash
# Send session summary to Slack
summary=$(jq -r '{
  interactions: (.interactions | length),
  tools: [.interactions[] | select(.type == "tool_call") | .content.tool] | unique | join(", ")
} | "Session completed: \(.interactions) interactions, tools used: \(.tools)"' \
  .claude/session_logs/session_$(date +%Y-%m-%d).json)

curl -X POST -H 'Content-type: application/json' \
  --data "{\"text\":\"$summary\"}" \
  "$SLACK_WEBHOOK_URL"
```

### Daily Report Generation

```bash
#!/bin/bash
# daily_report.sh - Generate daily session report

TODAY=$(date +%Y-%m-%d)
LOG_FILE=".claude/session_logs/session_${TODAY}.json"

if [ ! -f "$LOG_FILE" ]; then
  echo "No session log for today"
  exit 0
fi

echo "=== Claude Code Session Report - ${TODAY} ==="
echo ""

jq -r '
"Session ID: \(.session_id)"
+ "\nStart: \(.start_timestamp)"
+ "\nEnd: \(.end_timestamp // "In progress")"
+ "\n\nInteractions:"
+ "\n  User messages: \([.interactions[] | select(.type == "user_message")] | length)"
+ "\n  Tool calls: \([.interactions[] | select(.type == "tool_call")] | length)"
+ "\n  Assistant summaries: \([.interactions[] | select(.type == "assistant_summary")] | length)"
+ "\n\nTools used:"
+ "\n  \([.interactions[] | select(.type == "tool_call") | .content.tool] | unique | join(", "))"
' "$LOG_FILE"

echo ""
echo "=== Assistant Summaries ==="
jq -r '.interactions[] | select(.type == "assistant_summary") |
  "[\(.timestamp)] \(.content.summary)"' "$LOG_FILE"
```
