# Coverage Requirements Specification
# Defines coverage thresholds and reporting configuration

coverage_configuration:
  target_file: "curator.py"

  thresholds:
    lines:
      minimum: 100
      target: 100
      description: "Every executable line must be tested"

    branches:
      minimum: 100
      target: 100
      description: "Every decision path must be tested"

  exclusions:
    patterns:
      - "if __name__ == .__main__.:"
      - "pragma: no cover"
      - "raise NotImplementedError"
      - "pass"

    lines:
      # Specific line numbers to exclude (if any)
      # Example: 432 (if main block unreachable in tests)

    reasons:
      - "Main block only executed when run directly, not via pytest"
      - "Defensive code marked explicitly as no cover"

  reporting:
    formats:
      terminal:
        enabled: true
        show_missing: true
        precision: 2

      html:
        enabled: true
        output_dir: "htmlcov/"
        title: "Plugin Curator Test Coverage"

      xml:
        enabled: true
        output_file: "coverage.xml"
        for_ci_cd: true

      json:
        enabled: false
        output_file: "coverage.json"

    fail_under:
      lines: 100
      branches: 100
      enforcement: "strict"

pytest_configuration:
  coverage_options:
    - "--cov=curator"
    - "--cov-report=term-missing"
    - "--cov-report=html"
    - "--cov-report=xml"
    - "--cov-branch"
    - "--cov-fail-under=100"

  parallel_execution:
    enabled: true
    workers: "auto"  # Detect CPU cores
    distribution: "loadfile"

  test_discovery:
    patterns:
      - "test_*.py"
      - "*_test.py"
    directories:
      - "tests/"

  markers:
    unit:
      description: "Unit tests with mocked dependencies"
    integration:
      description: "Integration tests with real file system"
    slow:
      description: "Tests that take > 1 second"
    edge_case:
      description: "Edge case and boundary condition tests"

coverage_goals:
  phase_1_baseline:
    description: "Initial coverage after basic test implementation"
    lines: 70
    branches: 60

  phase_2_comprehensive:
    description: "Coverage after edge case tests"
    lines: 90
    branches: 80

  phase_3_complete:
    description: "Final 100% coverage"
    lines: 100
    branches: 100

uncovered_code_tracking:
  priority_areas:
    critical:
      - "Error handling paths in add_plugin()"
      - "Exception handling in discover_hooks()"
      - "Exception handling in discover_mcps()"
      - "Git clone error paths"
      - "Registry save/load error paths"

    medium:
      - "TUI navigation logic"
      - "Component flattening edge cases"

    low:
      - "Help text and version display"

validation_checklist:
  pre_commit:
    - "Run: pytest --cov=curator --cov-fail-under=100"
    - "Verify: All tests pass"
    - "Verify: Coverage reports generated"
    - "Check: No uncovered lines in htmlcov/"

  ci_cd:
    - "Run: pytest -n auto --cov=curator --cov-report=xml"
    - "Upload: coverage.xml to codecov/coveralls"
    - "Gate: Fail build if coverage < 100%"
    - "Artifact: Store htmlcov/ for inspection"

branch_coverage_specifics:
  target_branches:
    - description: "if REGISTRY_FILE.exists() in load_registry()"
      branches: ["true", "false"]

    - description: "if is_url(source) in add_plugin()"
      branches: ["true", "false"]

    - description: "if plugin_json_path.exists() in add_plugin()"
      branches: ["true", "false"]

    - description: "try/except blocks in discovery functions"
      branches: ["success", "exception"]

    - description: "if not hooks_file.exists() in discover_hooks()"
      branches: ["true", "false"]

    - description: "Error handling in CLI commands"
      branches: ["success", "error_exit"]

performance_benchmarks:
  coverage_collection_overhead:
    acceptable_slowdown: "< 20%"
    measurement: "Compare pytest duration with/without --cov"

  report_generation:
    html_max_time_seconds: 5
    xml_max_time_seconds: 2
    terminal_max_time_seconds: 1
